<config arch="">

	<common_routes>
		<service name="ROM" label_last="ld.lib.so"> <parent/> </service>
		<service name="ROM" label_last="init">      <parent/> </service>
		<service name="CPU">   <parent/> </service>
		<service name="PD">    <parent/> </service>
		<service name="LOG">   <parent/> </service>
		<service name="Timer"> <parent/> </service>
	</common_routes>

	<start name="fonts_fs" pkg="fonts_fs">
		<route>
			<service name="ROM" label="config">
				<parent label="config -> managed/fonts"/> </service>
		</route>
	</start>

	<start name="touch_keyboard"/>

	<start name="system_clock-dummy" pkg="system_clock-dummy">
		<route>
			<service name="ROM" label_last="dummy_rtc_drv"> <parent label="dummy_rtc_drv"/> </service>
		</route>
	</start>

<!--
	<start name="audio_drv" pkg="a64_audio_drv" priority="0" cpu="40">
		<resource name="CPU" quantum="40"/>
		<affinity xpos="0" ypos="0" width="1" height="1"/>
		<route>
			<service name="Platform"> <parent label="audio_drv"/> </service>
		</route>
	</start>
-->

<!--
	<start name="mixer" pkg="mixer">
		<config>
			<default out_volume="100" volume="100"/>
		</config>
		<route>
			<service name="Report"> <child name="black_hole"/> </service>
			<service name="Audio_out"> <child name="audio_drv"/> </service>
		</route>
	</start>
-->

	<start name="black_hole" pkg="black_hole">
		<config>
			<audio_in/>
			<audio_out/>
			<capture/>
			<report/>
			<gpu/>
		</config>
	</start>

<!--
	<start ram="256M" name="gpu_drv" pkg="a64_lima_gpu_drv-pinephone">
		<affinity xpos="0" width="1"/>
		<route>
			<service name="Platform"> <parent label="gpu"/> </service>
		</route>
	</start>

	<start name="mesa_gpu-lima" pkg="mesa_gpu-lima">
		<route>
			<service name="RM"> <parent/> </service>
		</route>
	</start>
-->

	<start name="mesa_gpu-cpu" pkg="mesa_gpu-cpu">
		<route>
			<service name="RM"> <parent/> </service>
		</route>
	</start>

<!--
	<start name="camera" pkg="camera-pinephone">
		<affinity xpos="3" width="1"/>
		<route>
			<service name="Timer">       <parent/> </service>
			<service name="Platform">    <parent label="camera"/> </service>
			<service name="Pin_state">   <parent/> </service>
			<service name="Pin_control"> <parent/> </service>
		</route>
	</start>
-->

<!--
	<start name="test-capture" pkg="test-capture">
		<affinity xpos="3" width="1"/>
		<config period_ms="66" width="640" height="480">
			<view/>
		</config>
		<route>
			<service name="Timer">   <parent/> </service>
			<service name="Gui">     <parent/> </service>
			<service name="Capture"> <child name="camera"/> </service>
		</route>
	</start>
-->


	<start name="mmcblk0.part_block" pkg="part_block">
		<route>
			<service name="Block">
				<parent label="sd_card_drv"/>
			</service>
			<service name="Report" label="partitions">
				<parent/>
			</service>
		</route>
	</start>

	<start name="mmcblk0.1.fs" pkg="ext2_fs">
		<route>
			<service name="Block"> <child name="mmcblk0.part_block" label="1"/> </service>
			<service name="RM"> <parent/> </service>
		</route>
	</start>


	<start ram="1024M" name="trace_recorder" pkg="trace_recorder">
		<config period_ms="1000" enable="yes">
			<vfs> <fs/> </vfs>
			<!--<policy label_suffix="morph-browser" policy="ctf0" buffer="111M" thread="ep">-->
			<policy label_suffix="morph-browser" policy="ctf0" buffer="16M">
				<ctf/>
			</policy>
<!--
			<policy label_suffix="jitter_sponge" policy="ctf0" buffer="11M">
				<ctf/>
			</policy>
-->
		</config>
		<route>
			<service name="RM"> <parent/> </service>
			<service name="TRACE"> <parent/> </service>
			<service name="Rtc"> <child name="system_clock-dummy"/>	</service>
			<service name="File_system"> <child name="mmcblk0.1.fs"/> </service>
		</route>
	</start>


	<start ram="700M" name="morph_browser" pkg="morph_browser-software">
	<!--<start ram="1350M" name="morph_browser" pkg="cproc_pinephone/pkg/morph_browser/2022-12-05-a">-->
	<!--<start ram="1350M" name="morph_browser" pkg="cproc_pinephone/pkg/morph_browser-jemalloc/2022-12-12">-->
	<!--<start ram="1350M" name="morph_browser" pkg="cproc_pinephone/pkg/morph_browser-jemalloc-software/2022-11-29">-->
	<!--<start ram="1350M" name="morph_browser" pkg="cproc_pinephone/pkg/falkon-jemalloc/2022-11-22-a">-->
		<affinity xpos="1" width="1"/>
		<route>
			<service name="Nic">
				<child name="nic_router"/>
			</service>
			<service name="File_system" label="config">
				<child name="ram_fs"/>
			</service>
			<service name="File_system" label="downloads">
				<child name="ram_fs"/>
			</service>
			<service name="Gui">
				<parent label="focus"/>
			</service>
			<service name="Report" label="morph_browser -> shape">
				<parent label="shape"/>
			</service>
			<service name="Report" label="clipboard">
				<parent/>
			</service>
			<service name="ROM" label="clipboard">
				<parent/>
			</service>
			<service name="Report" label="shape">
				<parent/>
			</service>
			<service name="Rtc">
				<child name="system_clock-dummy"/>
			</service>
			<service name="Audio_out">
				<child name="black_hole"/>
			</service>
			<service name="Audio_in">
				<child name="black_hole"/>
			</service>
<!--
			<service name="Capture">
				<child name="camera"/>
			</service>
-->
			<service name="Gpu">
				<child name="black_hole"/>
			</service>
			<service name="ROM" label="mesa_gpu_drv.lib.so">
				<child name="mesa_gpu-cpu"/>
			</service>
		</route>
	</start>

</config>
